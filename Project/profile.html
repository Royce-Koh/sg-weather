<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Name | Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        #map {
            height: 100vh;
            /* Full-screen height */
            width: 100%;
            /* Full-screen width */
        }
    </style>
</head>

<body>
    <div id="app" class="container-fluid">
        <div class="row">
            <div class="col-4">
                <div class="text-center position-relative">
                    <img id="showProfilePic" src="img/blankProfilePicture.png" alt="Profile Picture"
                        class="w-50 rounded-circle border border-dark">
                    <button type="button"
                        class="btn btn-light rounded-circle border-dark p-1 d-flex align-items-center position-absolute bottom-0"
                        style="width: 4vw; height: 4vw; right: 25%" data-bs-toggle="modal"
                        data-bs-target="#profilePicModal">
                        <img class="w-100" src="img/cameraIcon.png" alt="Camera Icon">
                    </button>
                </div>
                <div>
                    Username:<br>
                    <span id="showUsername"></span>
                    <button type="button" class="btn" style="width: 40px; height: 40px" data-bs-toggle="modal"
                        data-bs-target="#usernameModal">
                        <img class="w-100" src="img/edit.png" alt="Edit Icon">
                    </button>
                </div>
                <div>
                    Email:<br>
                    <span id="showEmail"></span>
                    <button type="button" class="btn" style="width: 40px; height: 40px" data-bs-toggle="modal"
                        data-bs-target="#emailModal">
                        <img class="w-100" src="img/edit.png" alt="Edit Icon">
                    </button>
                </div>
                <hr>
                Account Settings<br>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#passwordModal">Change
                    Password</button><br>
                Your Location:
                <span id="showLocation"></span>
                <button type="button" class="btn" style="width: 40px; height: 40px" data-bs-toggle="modal"
                    data-bs-target="#locationModal">
                    <img class="w-100" src="img/edit.png" alt="Edit Icon">
                </button>
            </div>
            <div class="col-8">
                Your Performance
            </div>
        </div>
        <!-- Profile Picture Modal -->
        <div class="modal fade" id="profilePicModal" tabindex="-1" aria-labelledby="profilePicModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="profilePicModalLabel">Change Picture</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="file" id="uploadProfilePic">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="changeImg()">Save
                            changes</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Username Modal -->
        <div class="modal fade" id="usernameModal" tabindex="-1" aria-labelledby="usernameModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <form class="g-3 needs-validation" novalidate>
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="usernameModalLabel">Change Username</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <label for="validationCustomUsername" class="form-label">New Username</label>
                            <div class="input-group has-validation">
                                <input type="text" class="form-control" id="validationCustomUsername"
                                    aria-describedby="inputGroupPrepend" required>
                                <div class="invalid-feedback">
                                    Username is invalid
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary" onclick="changeUsername()">Save
                                changes</button>

                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Email Modal -->
        <div class="modal fade" id="emailModal" tabindex="-1" aria-labelledby="emailModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <form class="g-3 needs-validation" novalidate>
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="emailModalLabel">Change Email</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <label for="validationCustomUsername" class="form-label">New Email</label>
                            <div class="input-group has-validation">
                                <input type="text" class="form-control" id="validationCustomUsername"
                                    aria-describedby="inputGroupPrepend" required>
                                <div class="invalid-feedback">
                                    Email is invalid
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary" onclick="changeEmail()">Save
                                changes</button>

                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Password Modal -->
        <div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <form class="g-3 needs-validation" novalidate>
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="passwordModalLabel">Change Password</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <label for="validationCustomUsername" class="form-label">Current Password</label>
                            <div class="input-group has-validation">
                                <input type="text" class="form-control" id="validationCustomUsername"
                                    aria-describedby="inputGroupPrepend" required>
                                <div class="invalid-feedback">
                                    Password is invalid
                                </div>
                            </div>
                            <label for="validationCustomUsername" class="form-label">New Password</label>
                            <div class="input-group has-validation">
                                <input type="text" class="form-control" id="validationCustomUsername"
                                    aria-describedby="inputGroupPrepend" required>
                                <div class="invalid-feedback">
                                    Password is invalid
                                </div>
                            </div>
                            <label for="validationCustomUsername" class="form-label">Confirm Password</label>
                            <div class="input-group has-validation">
                                <input type="text" class="form-control" id="validationCustomUsername"
                                    aria-describedby="inputGroupPrepend" required>
                                <div class="invalid-feedback">
                                    Password is invalid
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary" onclick="changeEmail()">Save
                                changes</button>

                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Location Modal -->
        <div class="modal fade" id="locationModal" tabindex="-1" aria-labelledby="locationModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="locationModalLabel">Change Location</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="map"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                            onclick="changeLocation()">Save
                            changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        let username = 'tom';
        let email = 'tom@gmail.com';
        updateImg();
        document.getElementById('showUsername').innerText = username;
        document.getElementById('showEmail').innerText = email;
        function updateImg() {
            axios.get('profile.php', {
                params: {
                    user: username
                }
            })
                .then(response => {
                    let filename = response.data;
                    if (filename !== 'No image') {
                        console.log(filename);
                        document.getElementById('showProfilePic').src = 'img/' + filename;
                    }
                })
        }
        function changeImg() {
            axios.get('profile.php', {
                params: {
                    newUser: username,
                    fileName: 'mary2.jpg'
                }
            })
                .then(updateImg())
        }
        function changeUsername() {

        }
        function changeEmail() {

        }
        function changeLocation() {

        }
        (() => {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            const forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }

                    form.classList.add('was-validated')
                }, false)
            })
        })()
        // Initialize and add the map
        function initMap() {
            // Default map options in case geolocation fails
            const defaultLocation = { lat: 37.7749, lng: -122.4194 }; // San Francisco, CA

            // Create a map centered on default location
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 12,
                center: defaultLocation,
            });

            // Attempt to geolocate user
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        // Center map on user's location
                        map.setCenter(userLocation);

                        // Add marker for user's location
                        new google.maps.Marker({
                            position: userLocation,
                            map: map,
                            title: "You are here!",
                        });
                    },
                    () => {
                        // Geolocation failed, handle the error
                        handleLocationError(true, map.getCenter());
                    }
                );
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, map.getCenter());
            }
        }

        // Handle Geolocation errors
        function handleLocationError(browserHasGeolocation, pos) {
            alert(
                browserHasGeolocation
                    ? "Error: The Geolocation service failed."
                    : "Error: Your browser doesn't support geolocation."
            );
        }
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAVUL0AbiGZmoGcNmHjwMMrNpO4bUkDJI&callback=initMap">
        </script>
</body>

</html>